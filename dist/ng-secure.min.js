/*! ng-secure 21-04-2014 */
!function(){angular.module("ngSecure",[]),angular.module("ngSecure").factory("AuthInterceptor",["$q","$rootScope","User",function(a,b,c){return{request:function(b){return c.isAuthenticated()&&(b.headers["X-AuthToken"]=c.getAuthToken()),b||a.when(b)},responseError:function(c){console.log("rejection",c);{var d=c.status;c.config}return 401===d&&"unauthorized"===c.data.code&&b.$broadcast("Auth:Failed"),a.reject(c)}}}]).service("Security",["Restangular","$q","$state","User","$rootScope","Secure",function(a,b,c,d,e,f){var g=a.all("auths");this.loginStatus=function(a,b,c){g.customGET("is_signed_in").then(function(b){d.setUser(b.auth_token,b.profile),(a||angular.noop)(b)},b||angular.noop).finally(c||angular.noop)},this.emailLogin=function(a,b,c,e){g.customPOST(a,"email_sign_in").then(function(a){d.setUser(a.auth_token,a.profile),(b||angular.noop)(a)},c||angular.noop).finally(e||angular.noop)},this.emailSignup=function(a,b,c,e){g.customPOST(a,"email_sign_up").then(function(a){d.setUser(a.auth_token,a.profile),(b||angular.noop)(a)},c||angular.noop).finally(e||angular.noop)},this.facebookSignup=function(a,b,c,e){g.customPOST(a,"facebook_sign_up").then(function(a){d.setUser(a.auth_token,a.profile),(b||angular.noop)(a)},c||angular.noop).finally(e||angular.noop)},this.facebookLogin=function(a,b,c,e){g.customPOST(a,"facebook_sign_in").then(function(a){d.setUser(a.auth_token,a.profile),(b||angular.noop)(a)},c||angular.noop).finally(e||angular.noop)},this.logout=function(a,b,c){g.customPOST({},"sign_out").then(function(b){d.clearUser(),(a||angular.noop)(b)},b||angular.noop).finally(c||angular.noop)},this.getFacebookScope=function(){return{scope:"email,user_likes"}},e.$on("Auth:Failed",f.authFailed),e.$on("$stateChangeStart",f.transition)}]),angular.module("ui-router-secure",["ui.router"]).provider("Secure",function(){var a="isAuthenticated",b="",c=function(a){return!(Object.getOwnPropertyNames(a).length>0)},d=function(a,b){for(var c=!0,d=b,e={};c;){e=angular.extend(d.secure||{},e);var d=d.name.split(".");d.length>1?(d.pop(),d=a.get(d.join("."))):c=!1}return e};return{setIsAuthenticated:function(b){a=b},setDefaultState:function(a){b=a},$get:["$q","$state","$stateParams","User",function(e,f,g,h){var i=this;return this.transition=function(e,g){console.log("toState",g);var i=d(f,g);i&&!c(i)&&(console.log("secure",i),angular.isDefined(i.authenticated)&&i.authenticated&&!h[a]()&&(console.log("defaultState",b),f.go(b),e.preventDefault()))},this.authFailed=function(){console.log("Auth:Failed"),h.clearUser(),f.go(b)},i}]}}).run(["Secure","$rootScope",function(a,b){b.$on("Auth:Failed",a.authFailed),b.$on("$stateChangeStart",a.transition)}]),angular.module("ngSecure").service("User",["$localStorage","$timeout",function(a){var b=this;this.$storage=a,this.alerts=[],this.getAuthToken=function(){return this.$storage.authToken},this.getUserDetails=function(){return this.$storage.userDetails},this.setUser=function(a,c){b.$storage.authToken=a,b.$storage.userDetails=c},this.setUserDetails=function(a){b.$storage.userDetails=a},this.clearUser=function(){delete b.$storage.userDetails,delete b.$storage.authToken},this.isAuthenticated=function(){return angular.isDefined(b.$storage.authToken)&&null!==b.$storage.authToken},this.getFirstName=function(){return this.$storage.userDetails?this.$storage.userDetails.first_name:""},this.getLastName=function(){return this.$storage.userDetails?this.$storage.userDetails.last_name:""},this.getFullName=function(){return b.getFirstName()+" "+b.getLastName()},this.getProfile=function(){return this.$storage.userDetails}}])}(window,document);